<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>6ol Core Hub · v1.9</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ==== SCREEN STYLES (unchanged) ==== */
    :root {
      --bg: #111;
      --fg: #eee;
      --accent: #f5c84c;
      --search-bg: #222;
      --search-border: #444;
    }
    * {
      box-sizing: border-box;
      scroll-behavior: smooth;
    }
    body {
      margin: 0;
      font-family: "Helvetica Neue", sans-serif;
      background: var(--bg);
      color: var(--fg);
      line-height: 1.6;
    }
    header {
      padding: 2rem 1rem;
      text-align: center;
    }
    nav {
      position: sticky;
      top: 0;
      z-index: 10;
      background: #000c;
      backdrop-filter: blur(6px);
      display: flex;
      gap: 1rem;
      justify-content: center;
      padding: 0.5rem;
    }
    nav a {
      color: var(--fg);
      text-decoration: none;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      transition: background 0.2s;
    }
    nav a.active,
    nav a:hover {
      background: var(--accent);
      color: #000;
    }
    /* Search input styling */
    #search-container {
      margin: 1rem auto;
      max-width: 400px;
      padding: 0 1rem;
    }
    #search-input {
      width: 100%;
      padding: 0.5rem 1rem;
      background: var(--search-bg);
      border: 1px solid var(--search-border);
      border-radius: 0.25rem;
      color: var(--fg);
      font-size: 1rem;
    }
    /* “No results” message */
    #no-results {
      margin: 0.5rem auto 1.5rem auto;
      max-width: 400px;
      padding: 0.75rem 1rem;
      background: #2a2a2a;
      border: 1px solid #444;
      border-radius: 0.25rem;
      color: #f88;
      text-align: center;
      display: none;
      font-size: 0.95rem;
    }
    section {
      padding: 3rem 1rem;
      max-width: 800px;
      margin: auto;
    }
    section h2 {
      margin-bottom: 1rem;
    }
    .locked {
      opacity: 0.35;
      filter: blur(2px);
    }
    .item-list {
      list-style: none;
      padding-left: 0;
    }
    .item-list li {
      margin-bottom: 0.75rem;
      padding-left: 1.5rem;
      position: relative;
    }
    .item-list li::before {
      content: "🔹";
      position: absolute;
      left: 0;
      top: 0;
    }
    .item-list li a {
      color: var(--fg);
      text-decoration: none;
      font-weight: bold;
    }
    .item-list li a:hover {
      text-decoration: underline;
    }
    .item-list li small {
      display: block;
      font-size: 0.85rem;
      opacity: 0.75;
      margin-top: 0.25rem;
    }
    textarea {
      background: #222;
      border: 1px solid var(--search-border);
      border-radius: 0.25rem;
      color: var(--fg);
      padding: 0.5rem;
      font-family: inherit;
      font-size: 1rem;
    }
    #last-updated {
      text-align: center;
      font-size: 0.85rem;
      opacity: 0.7;
      margin: 1rem 0;
    }
    footer {
      text-align: center;
      padding: 2rem 1rem;
      font-size: 0.875rem;
    }
    form#pass-form {
      margin: 1rem auto;
      max-width: 280px;
      display: flex;
      gap: 0.5rem;
    }
    form#pass-form input,
    form#pass-form button {
      border: none;
      border-radius: 0.25rem;
      font-family: inherit;
    }
    form#pass-form input {
      flex: 1;
      padding: 0.5rem;
      background: #222;
      color: var(--fg);
    }
    form#pass-form button {
      padding: 0.5rem 1rem;
      background: var(--accent);
      color: #000;
      cursor: pointer;
    }
    #past-entries {
      margin-top: 2rem;
    }
    #past-entries h3 {
      margin-bottom: 1rem;
    }

    /* ==== PRINT STYLES ==== */
    @media print {
      /* Force white background & black text */
      body {
        background: #fff !important;
        color: #000 !important;
      }
      /* Hide nav, search, passform, footer, “no results” */
      nav,
      #search-container,
      footer,
      form#pass-form,
      #no-results {
        display: none !important;
      }
      /* Make headers black */
      h1, h2, h3, h4, h5 {
        color: #000 !important;
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
      }
      /* Remove background from textareas */
      textarea {
        background: transparent !important;
        border: 1px solid #000 !important;
        color: #000 !important;
      }
      /* Ensure links print their URL in parentheses */
      a::after {
        content: " (" attr(href) ")";
        font-size: 0.85em;
      }
      a {
        color: #000 !important;
        text-decoration: underline !important;
      }
      /* Make list bullets solid black */
      .item-list li::before {
        content: "•";
        color: #000;
      }
      /* Remove item-list indentation for compactness */
      .item-list {
        padding-left: 1rem !important;
      }
      .item-list li {
        padding-left: 0.5rem !important;
      }
      /* Show all unlocked sections by default */
      [data-level] {
        opacity: 1 !important;
        filter: none !important;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>6ol Core Hub</h1>
  <p class="tagline">A sovereign playground for seekers &amp; builders.</p>

  <!-- Passphrase unlock -->
  <form id="pass-form">
    <input
      id="pass-input"
      type="password"
      placeholder="Enter passphrase"
      autocomplete="off"
    />
    <button type="submit">Unlock</button>
  </form>
  <p style="font-size: 0.9rem;">
    Current level: <span id="current-level">0</span>
  </p>
</header>

<nav id="navbar">
  <a href="#scrolls">Scrolls</a>
  <a href="#rituals">Rituals</a>
  <a href="#journal">Journal</a>
  <a href="#podcast">Podcast</a>
  <a href="#finance">Finance</a>
  <a href="#legal">Legal</a>
  <a href="#analytics">Analytics</a>
  <a href="#control-center">Control Center</a>
  <a href="#navarre">Navarre</a>
  <a href="#contact">Contact</a>
</nav>

<!-- Client-side search box -->
<div id="search-container">
  <input
    id="search-input"
    type="text"
    placeholder="Search all items…"
  />
  <p id="no-results">No matching items found.</p>
</div>

<main>
  <!-- Scrolls (requires level 1+) -->
  <section id="scrolls" data-level="1" class="locked">
    <h2>📜 Scrolls</h2>
    <p>Teachings unlocked by loop-level and passphrase.</p>
    <ul class="item-list" id="scrolls-list">
      <!-- Populated by loadScrolls() -->
    </ul>
  </section>

  <!-- Rituals (requires level 1+) -->
  <section id="rituals" data-level="1" class="locked">
    <h2>🕯 Rituals</h2>
    <p>Core practices to keep the energy loop flowing.</p>
    <ul class="item-list" id="rituals-list">
      <!-- Populated by loadRituals() -->
    </ul>
  </section>

  <!-- Journal (open to all) -->
  <section id="journal" data-level="0">
    <h2>✍️ Journal</h2>
    <textarea
      id="entry"
      rows="8"
      placeholder="Write today’s reflection..."
    ></textarea>
    <p id="timestamp" style="font-size: 0.8rem; opacity: 0.7;"></p>

    <div id="past-entries">
      <h3>🗂 Past Entries</h3>
      <ul class="item-list" id="entries-list">
        <!-- Populated by loadJournalEntries() -->
      </ul>
    </div>
  </section>

  <!-- Podcast (open to all) -->
  <section id="podcast" data-level="0">
    <h2>🎧 OnTheComeUp Podcast</h2>
    <p>Episode captions &amp; show notes, organized by episode number.</p>
    <ul class="item-list" id="podcast-list">
      <!-- Populated by loadPodcast() -->
    </ul>
  </section>

  <!-- Finance (open to all) -->
  <section id="finance" data-level="0">
    <h2>💰 Finance Streams</h2>
    <p>Daily P&amp;L, payout summaries, or ledger entries.</p>
    <ul class="item-list" id="finance-list">
      <!-- Populated by loadFinance() -->
    </ul>
  </section>

  <!-- Legal Tasks (open to all) -->
  <section id="legal" data-level="0">
    <h2>⚖️ Legal Tasks</h2>
    <p>Upcoming deadlines, motions, and filings—stay on track.</p>
    <ul class="item-list" id="legal-list">
      <!-- Populated by loadLegalTasks() -->
    </ul>
  </section>

  <!-- Analytics (open to all) -->
  <section id="analytics" data-level="0">
    <h2>📊 Analytics</h2>
    <p>Monthly revenue and key metrics.</p>
    <p>
      <a href="analytics/monthly-revenue-2025-06.html" target="_blank"
         style="color: var(--accent); font-weight: bold;">
        View June 2025 Revenue Report →
      </a>
    </p>
  </section>

  <!-- Control Center (open to all) -->
  <section id="control-center" data-level="0">
    <h2>🗄 Control Center</h2>
    <p>Your master project dashboard and notes.</p>
    <p>
      <a href="control-center.html" target="_blank"
         style="color: var(--accent); font-weight: bold;">
        Open Control Center →
      </a>
    </p>
  </section>

  <!-- Navarre Email Kit (open to all) -->
  <section id="navarre" data-level="0">
    <h2>✉️ Navarre Email Kit</h2>
    <p>Legal email drafts, organized and ready to send.</p>
    <ul class="item-list" id="navarre-list">
      <!-- Populated by loadNavarreEmails() -->
    </ul>
  </section>

  <!-- Contact (open to all) -->
  <section id="contact" data-level="0">
    <h2>📬 Contact</h2>
    <p>Email: ellery.p.costaiii@icloud.com</p>
  </section>

  <!-- Last updated timestamp -->
  <p id="last-updated">Last updated: </p>
</main>

<footer>© 2025 4got1en · Built entirely on an iPhone</footer>

<!-- Keep loop-engine.js for gating & journal persistence -->
<script src="loop-engine.js"></script>

<script>
  // ---- Load Scrolls ----
  async function loadScrolls() {
    try {
      const res = await fetch('scrolls/manifest.json');
      if (!res.ok) throw new Error('Failed to fetch scrolls/manifest.json');
      const items = await res.json();
      const ul = document.getElementById('scrolls-list');
      items.forEach(item => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = `scrolls/${item.filename}`;
        link.textContent = item.title;
        link.target = '_blank';
        li.appendChild(link);
        li.appendChild(document.createElement('br'));
        const small = document.createElement('small');
        small.textContent = item.summary;
        li.appendChild(small);
        ul.appendChild(li);
      });
    } catch (e) {
      console.error('Error loading scrolls manifest:', e);
    }
  }

  // ---- Load Rituals ----
  async function loadRituals() {
    try {
      const res = await fetch('rituals/manifest.json');
      if (!res.ok) throw new Error('Failed to fetch rituals/manifest.json');
      const items = await res.json();
      const ul = document.getElementById('rituals-list');
      items.forEach(item => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = `rituals/${item.filename}`;
        link.textContent = item.title;
        link.target = '_blank';
        li.appendChild(link);
        li.appendChild(document.createElement('br'));
        const small = document.createElement('small');
        small.textContent = item.summary;
        li.appendChild(small);
        ul.appendChild(li);
      });
    } catch (e) {
      console.error('Error loading rituals manifest:', e);
    }
  }

  // ---- Load Journal Entries ----
  async function loadJournalEntries() {
    try {
      const res = await fetch('journals/manifest.json');
      if (!res.ok) throw new Error('Failed to fetch journals/manifest.json');
      const manifest = await res.json();
      const ul = document.getElementById('entries-list');
      manifest.forEach(item => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = `journals/${item.filename}`;
        link.textContent = item.date;
        link.target = '_blank';
        li.appendChild(link);
        li.appendChild(document.createElement('br'));
        const small = document.createElement('small');
        small.textContent = item.summary;
        li.appendChild(small);
        ul.appendChild(li);
      });
    } catch (e) {
      console.error('Error loading journal manifest:', e);
    }
  }

  // ---- Load Podcast Entries ----
  async function loadPodcast() {
    try {
      const res = await fetch('onthecomeup/manifest.json');
      if (!res.ok) throw new Error('Failed to fetch onthecomeup/manifest.json');
      const items = await res.json();
      const ul = document.getElementById('podcast-list');
      items.forEach(item => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = `onthecomeup/${item.filename}`;
        link.textContent = item.title;
        link.target = '_blank';
        li.appendChild(link);
        li.appendChild(document.createElement('br'));
        const small = document.createElement('small');
        small.textContent = item.summary;
        li.appendChild(small);
        ul.appendChild(li);
      });
    } catch (e) {
      console.error('Error loading podcast manifest:', e);
    }
  }

  // ---- Load Finance Entries ----
  async function loadFinance() {
    try {
      const res = await fetch('finance/manifest.json');
      if (!res.ok) throw new Error('Failed to fetch finance/manifest.json');
      const items = await res.json();
      const ul = document.getElementById('finance-list');
      items.forEach(item => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = `finance/${item.filename}`;
        link.textContent = item.title;
        link.target = '_blank';
        li.appendChild(link);
        li.appendChild(document.createElement('br'));
        const small = document.createElement('small');
        small.textContent = item.summary;
        li.appendChild(small);
        ul.appendChild(li);
      });
    } catch (e) {
      console.error('Error loading finance manifest:', e);
    }
  }

  // ---- Load Legal Tasks Entries ----
  async function loadLegalTasks() {
    try {
      const res = await fetch('legal/manifest.json');
      if (!res.ok) throw new Error('Failed to fetch legal/manifest.json');
      const items = await res.json();
      const ul = document.getElementById('legal-list');
      items.forEach(item => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = `legal/${item.filename}`;
        link.textContent = item.title;
        link.target = '_blank';
        li.appendChild(link);
        li.appendChild(document.createElement('br'));
        const small = document.createElement('small');
        small.textContent = item.summary;
        li.appendChild(small);
        ul.appendChild(li);
      });
    } catch (e) {
      console.error('Error loading legal manifest:', e);
    }
  }

  // ---- Load Navarre Emails ----
  async function loadNavarreEmails() {
    try {
      const res = await fetch('navarre/manifest.json');
      if (!res.ok) throw new Error('Failed to fetch navarre/manifest.json');
      const items = await res.json();
      const ul = document.getElementById('navarre-list');
      items.forEach(item => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = `navarre/${item.filename}`;
        link.textContent = item.title;
        link.target = '_blank';
        li.appendChild(link);
        li.appendChild(document.createElement('br'));
        const small = document.createElement('small');
        small.textContent = item.summary;
        li.appendChild(small);
        ul.appendChild(li);
      });
    } catch (e) {
      console.error('Error loading navarre manifest:', e);
    }
  }

  // ---- Scrollspy Highlighting ----
  function initScrollspy() {
    const links = [...document.querySelectorAll('nav a')];
    const secs = links.map(a => document.querySelector(a.getAttribute('href')));
    window.addEventListener('scroll', () => {
      let i = secs.findIndex(
        s => s.getBoundingClientRect().top <= 60 && s.getBoundingClientRect().bottom >= 60
      );
      if (i === -1) i = 0;
      links.forEach((a, ix) => a.classList.toggle('active', ix === i));
    });
  }

  // ---- Journal Textarea Persistence ----
  function initJournalPersistence() {
    const entry = document.getElementById('entry'),
          ts = document.getElementById('timestamp'),
          KEY = '6ol_journal';
    function save() {
      localStorage.setItem(KEY, entry.value);
      ts.textContent = 'Last saved: ' + new Date().toLocaleString();
    }
    entry.addEventListener('input', save);
    const data = localStorage.getItem(KEY);
    if (data) {
      entry.value = data;
      ts.textContent = 'Last saved: ' + new Date().toLocaleString();
    }
  }

  // ---- Passphrase / Gating ----
  function initGating() {
    const STORAGE_KEY = '6ol_loop_level';
    const PASS_MAP = { sol: 1, luna: 2, umbra: 3 };
    function getLevel() {
      return Number(localStorage.getItem(STORAGE_KEY) || 0);
    }
    function setLevel(lvl) {
      localStorage.setItem(STORAGE_KEY, lvl);
      refreshUI();
    }
    function refreshUI() {
      const lvl = getLevel();
      document.getElementById('current-level').textContent = lvl;
      document.querySelectorAll('[data-level]').forEach(sec => {
        const req = Number(sec.dataset.level);
        if (lvl >= req) {
          sec.classList.remove('locked');
          sec.style.display = '';
        } else {
          sec.classList.add('locked');
          sec.style.display = (req === 0) ? '' : '';
        }
      });
    }
    document.getElementById('pass-form').addEventListener('submit', e => {
      e.preventDefault();
      const pw = document.getElementById('pass-input').value.trim().toLowerCase();
      if (PASS_MAP.hasOwnProperty(pw)) {
        const newLevel = PASS_MAP[pw];
        if (newLevel > getLevel()) {
          setLevel(newLevel);
          alert('🔓 Unlocked level ' + newLevel + '!');
        } else {
          alert('You already have this level or higher.');
        }
      } else {
        alert('❌ Invalid passphrase');
      }
      e.target.reset();
    });
    window.addEventListener('load', refreshUI);
  }

  // ---- Client-Side Search Filtering + “No Results” Toggle ----
  function initSearch() {
    const input = document.getElementById('search-input');
    const noResults = document.getElementById('no-results');

    input.addEventListener('input', () => {
      const query = input.value.trim().toLowerCase();
      const allLists = document.querySelectorAll('.item-list');
      let anyVisible = false;

      allLists.forEach(ul => {
        ul.querySelectorAll('li').forEach(li => {
          const text = li.textContent.toLowerCase();
          const show = (!query || text.includes(query));
          li.style.display = show ? '' : 'none';
          if (show) anyVisible = true;
        });
      });

      if (query && !anyVisible) {
        noResults.style.display = 'block';
      } else {
        noResults.style.display = 'none';
      }
    });
  }

  // ---- Insert “Last Updated” timestamp ----
  function insertLastUpdated() {
    const p = document.getElementById('last-updated');
    const modified = document.lastModified; // format: "MM/DD/YYYY HH:MM:SS"
    if (modified) {
      const [datePart, timePart] = modified.split(' ');
      const [m, d, y] = datePart.split('/');
      p.textContent = `Last updated: ${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')} ${timePart}`;
    } else {
      p.textContent = 'Last updated: (unknown)';
    }
  }

  // ---- Initialize everything on page load ----
  window.addEventListener('load', () => {
    loadScrolls();
    loadRituals();
    loadJournalEntries();
    loadPodcast();
    loadFinance();
    loadLegalTasks();
    loadNavarreEmails();
    initScrollspy();
    initJournalPersistence();
    initGating();
    initSearch();
    insertLastUpdated();
  });
</script>
</body>
</html>